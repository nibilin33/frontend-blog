(window.webpackJsonp=window.webpackJsonp||[]).push([[63],{337:function(t,s,a){"use strict";a.r(s);var n=a(14),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"基于行为驱动的自动化测试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#基于行为驱动的自动化测试"}},[t._v("#")]),t._v(" 基于行为驱动的自动化测试")]),t._v(" "),s("h2",{attrs:{id:"背景"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[t._v("#")]),t._v(" 背景")]),t._v(" "),s("p",[t._v("有多个平台的小程序渠道，测试还是传统的手工测试，一次改动测试回归成本很高，效率相对较低。"),s("br"),t._v("\n同时本身业务迭代还是很频繁，传统的自动化测试方案，维护UI脚本本身成本也很高，对测试人员本身的要求也不一样。")]),t._v(" "),s("h2",{attrs:{id:"技术选型"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#技术选型"}},[t._v("#")]),t._v(" 技术选型")]),t._v(" "),s("p",[t._v("由当下情况得出的核心诉求："),s("br"),t._v("\n1. UI 元素不通过脚本获取，降低需要频繁变更的可能"),s("br"),t._v("\n2. 即适合测试人员也适合研发人员，可以支持和当前系统结合"),s("br"),t._v("\n3. 多端的支持，web,android,ios"),s("br"),t._v("\n条件1，3 就抛弃了现在大部分依赖xpath的自动化框架")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("工具")]),t._v(" "),s("th",[t._v("优点")]),t._v(" "),s("th",[t._v("缺点")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("Appium")]),t._v(" "),s("td",[t._v("编写测试脚本时间较短，可预装，支持多种语言以及可跨平台进行，由谷歌社区支持和维护。")]),t._v(" "),s("td",[t._v("不能处理flash和web组件，由于不支持iOS设备，当自动化测试同时覆盖Android和iOS的情况时，测试会被中断，Appium server桌面应用程序的发布常常不稳定，在旧设备上变得很慢。")])]),t._v(" "),s("tr",[s("td",[t._v("Robotium")]),t._v(" "),s("td",[t._v("自动化app，Android自动跟随，简单易学的教程，且不需要访问源代码。")]),t._v(" "),s("td",[t._v("仅支持Android4.1及以上，不支持脚本记录，不支持web视图，不能跨多个app。")])]),t._v(" "),s("tr",[s("td",[t._v("UIAutomation")]),t._v(" "),s("td",[t._v("Android自动化测试工具类，通过脚本开发，由于运行绑定到GUI组件，相比Appium，它的测试执行更快更强大。")]),t._v(" "),s("td",[t._v("对测试人员来说编写代码能力要求较高，需要对Android相关知识有一定的了解。")])]),t._v(" "),s("tr",[s("td",[t._v("Instrumentation")]),t._v(" "),s("td",[t._v("可以模拟按键按下，抬起，屏幕点击，滚动事件等，第三方支付集成了基于云计算的测试管理。")]),t._v(" "),s("td",[t._v("仅支持Android")])])])]),t._v(" "),s("p",[t._v("条件2就抛弃现有大部分rpa工具，目前已有的rpa应用都偏向低代码的形式，更偏向业务人员")]),t._v(" "),s("h2",{attrs:{id:"核心思路"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#核心思路"}},[t._v("#")]),t._v(" 核心思路")]),t._v(" "),s("p",[t._v("airtest（处理移动端） + rpa-python（处理桌面端）")]),t._v(" "),s("ul",[s("li",[t._v("实现一个dsl解析器（dsl参考"),s("a",{attrs:{href:"https://github.com/songofhawk/simplerpa",target:"_blank",rel:"noopener noreferrer"}},[t._v("simplerpa"),s("OutboundLink")],1),t._v("）")]),t._v(" "),s("li",[t._v("用rpa-python重写airtest-selenium插件（存在兼容性问题，编辑器无法执行）")]),t._v(" "),s("li",[t._v("用chatgpt 将 Cucumber 测试用例转成 yaml配置文件")]),t._v(" "),s("li",[t._v("用chatgpt 将 Cucumber 测试用例转成 airtest 代码，通过airtest编辑器做UI元素调整")])]),t._v(" "),s("blockquote",[s("p",[t._v("Cucumber是一个测试框架，可以用来建立软件开发人员和业务经理之间沟通的渠道。测试脚本基于行为驱动开发（BDD）风格词语编写，如“假如”，“当”、“那么”，或在英文中的Given, When, Then，这样任何非专业人员都能理解。然后将测试用例放入覆盖一个或多个测试场景的剧本(gherkin)文件中。 Cucumber将测试解释成指定的编程语言，然后执行。典型的用法是使用Selenium驱动浏览器中进行测试。")])]),t._v(" "),s("h2",{attrs:{id:"屏幕自动化任务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#屏幕自动化任务"}},[t._v("#")]),t._v(" 屏幕自动化任务")]),t._v(" "),s("ol",[s("li",[t._v("检查当前桌面上是否显示了需要的页面（比如查看特定位置的图像，或者比对OCR识别出的文字）")]),t._v(" "),s("li",[t._v("如果确实是，就收集一些文字或图像的信息（这一步未必会有，要看具体任务类型，有些自动化只要把页面流程走通就可以）")]),t._v(" "),s("li",[t._v("查找页面上特定的控件（比如某个按钮），对它进行操作（如点击）")])]),t._v(" "),s("ul",[s("li",[t._v("软件元素识别\n"),s("ul",[s("li",[t._v("获取鼠标所在屏幕坐标")]),t._v(" "),s("li",[t._v("获取鼠标位置的窗体控件")]),t._v(" "),s("li",[t._v("获取控件类型")])])])]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" pywinauto "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Desktop\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 获取当前鼠标位置")]),t._v("\nmouse_pos "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Desktop"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mouse"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("position"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 获取鼠标位置的窗体控件")]),t._v("\ncontrol "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Desktop"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("from_point"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("mouse_pos"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 获取控件类型")]),t._v("\ncontrol_type "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" control"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("friendly_class_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Control type:'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" control_type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("在 Mac 上，获取鼠标位置的窗体控件和控件类型是一个复杂的任务，因为它需要使用到底层的 Accessibility API。Python 并没有直接提供这样的功能，但是你可以使用一些第三方库来实现。")]),t._v(" "),s("p",[t._v("其中一个可能的选择是 "),s("code",[t._v("pyobjc")]),t._v(" 库，它提供了 Python 到 Objective-C 的桥接，可以让你在 Python 中使用 Cocoa 和其他 Mac OS X 的原生 API。")]),t._v(" "),s("p",[t._v("以下是一个使用 "),s("code",[t._v("pyobjc")]),t._v(" 来获取鼠标位置的窗体控件和控件类型的基本示例：")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" Quartz "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" CGWindowListCopyWindowInfo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" kCGWindowListOptionOnScreenOnly"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" kCGNullWindowID\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" AppKit "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" NSWorkspace\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" PyObjCTools "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Conversion\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" time\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get_active_window")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 获取当前活动的窗口")]),t._v("\n    active_app "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" NSWorkspace"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sharedWorkspace"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("activeApplication"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" window "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" CGWindowListCopyWindowInfo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("kCGWindowListOptionOnScreenOnly"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" kCGNullWindowID"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 转换 Objective-C 的 NSDictionary 到 Python 的字典")]),t._v("\n        window "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Conversion"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pythonCollectionFromPropertyList"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("window"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" window"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'kCGWindowOwnerName'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" active_app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'NSApplicationName'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" window\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    window "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" get_active_window"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" window"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Window name:'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" window"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'kCGWindowName'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Unknown'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Window owner:'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" window"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'kCGWindowOwnerName'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    time"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sleep"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v('这个脚本会每秒打印一次当前活动窗口的名称和所有者。然而，这只是获取窗口信息的一部分，获取鼠标位置的窗体控件和控件类型可能需要更深入的使用 Accessibility API，这可能需要更多的 Objective-C 或 Swift 的知识和经验。\n请注意，使用 Accessibility API 可能需要用户授予你的应用特定的权限。在 "System Preferences" -> "Security & Privacy" -> "Privacy" -> "Accessibility" 中添加你的应用或脚本，以允许它控制你的电脑。')]),t._v(" "),s("ul",[s("li",[t._v("浏览器元素识别")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mousemove'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 获取鼠标所在的屏幕坐标")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" x "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" event"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("clientX"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" y "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" event"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("clientY"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Mouse coordinates:'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" x"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" y"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 获取鼠标位置的元素")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" element "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("elementFromPoint")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" y"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 获取元素类型")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" elementType "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" element"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tagName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Element type:'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" elementType"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("ul",[s("li",[t._v("图像识别定位（opencv）\n"),s("ul",[s("li",[t._v("屏幕截取")]),t._v(" "),s("li",[t._v("匹配模版")]),t._v(" "),s("li",[t._v("获取元素位置")])])]),t._v(" "),s("li",[t._v("图像识别的准确性和稳定性相对较低，且受到环境因素的影响较大，例如屏幕分辨率、颜色设置等")])]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" cv2\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" numpy "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" np\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" PIL "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" ImageGrab\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 截取屏幕图像")]),t._v("\nscreen "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" np"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("array"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ImageGrab"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("grab"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 读取模板")]),t._v("\ntemplate "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cv2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("imread"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'template.png'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 转换颜色空间")]),t._v("\nscreen_gray "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cv2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cvtColor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("screen"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" cv2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("COLOR_BGR2GRAY"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 匹配模板")]),t._v("\nres "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cv2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("matchTemplate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("screen_gray"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" template"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" cv2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("TM_CCOEFF_NORMED"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nmin_val"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" max_val"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" min_loc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" max_loc "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cv2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("minMaxLoc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 如果匹配度大于 80%")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" max_val "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.8")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Element found at'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" max_loc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("ol",{attrs:{start:"4"}},[s("li",[t._v("跳转到下一个页面，回到步骤1，反复循环，直到最终页面出现")])])])}),[],!1,null,null,null);s.default=e.exports}}]);