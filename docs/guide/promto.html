<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>内嵌web加载慢 | Nibl Blog</title>
    <meta name="description" content="记录所得">
    <link rel="shortcut icon" href="./cat_32.ico" type="image/x-icon">
    
    <link rel="preload" href="/frontend-blog/assets/css/0.styles.c0ba79bd.css" as="style"><link rel="preload" href="/frontend-blog/assets/js/app.796b580c.js" as="script"><link rel="preload" href="/frontend-blog/assets/js/3.b1978073.js" as="script"><link rel="preload" href="/frontend-blog/assets/js/31.c2069332.js" as="script"><link rel="prefetch" href="/frontend-blog/assets/js/10.ebfa02ec.js"><link rel="prefetch" href="/frontend-blog/assets/js/11.98200261.js"><link rel="prefetch" href="/frontend-blog/assets/js/12.2214155a.js"><link rel="prefetch" href="/frontend-blog/assets/js/13.93cfaea4.js"><link rel="prefetch" href="/frontend-blog/assets/js/14.4f3946be.js"><link rel="prefetch" href="/frontend-blog/assets/js/15.1cdb397b.js"><link rel="prefetch" href="/frontend-blog/assets/js/16.b68b9b2e.js"><link rel="prefetch" href="/frontend-blog/assets/js/17.b2015889.js"><link rel="prefetch" href="/frontend-blog/assets/js/18.f4193212.js"><link rel="prefetch" href="/frontend-blog/assets/js/19.597e1c00.js"><link rel="prefetch" href="/frontend-blog/assets/js/20.fb981611.js"><link rel="prefetch" href="/frontend-blog/assets/js/21.2d4daf0f.js"><link rel="prefetch" href="/frontend-blog/assets/js/22.3b8b50a1.js"><link rel="prefetch" href="/frontend-blog/assets/js/23.07e4aa78.js"><link rel="prefetch" href="/frontend-blog/assets/js/24.c42dd3ee.js"><link rel="prefetch" href="/frontend-blog/assets/js/25.ab5086e3.js"><link rel="prefetch" href="/frontend-blog/assets/js/26.f721ed11.js"><link rel="prefetch" href="/frontend-blog/assets/js/27.a40a3ead.js"><link rel="prefetch" href="/frontend-blog/assets/js/28.bdee0944.js"><link rel="prefetch" href="/frontend-blog/assets/js/29.c986e689.js"><link rel="prefetch" href="/frontend-blog/assets/js/30.89f379fe.js"><link rel="prefetch" href="/frontend-blog/assets/js/32.1465e5e6.js"><link rel="prefetch" href="/frontend-blog/assets/js/33.9a09ea4a.js"><link rel="prefetch" href="/frontend-blog/assets/js/34.c6c31a7d.js"><link rel="prefetch" href="/frontend-blog/assets/js/35.9f25c9f2.js"><link rel="prefetch" href="/frontend-blog/assets/js/36.0492f0f5.js"><link rel="prefetch" href="/frontend-blog/assets/js/37.eebdc834.js"><link rel="prefetch" href="/frontend-blog/assets/js/38.1e468205.js"><link rel="prefetch" href="/frontend-blog/assets/js/39.d7538256.js"><link rel="prefetch" href="/frontend-blog/assets/js/4.3a3c57cb.js"><link rel="prefetch" href="/frontend-blog/assets/js/40.e93dc842.js"><link rel="prefetch" href="/frontend-blog/assets/js/41.faee666a.js"><link rel="prefetch" href="/frontend-blog/assets/js/5.4a7bea4b.js"><link rel="prefetch" href="/frontend-blog/assets/js/6.ae7657e7.js"><link rel="prefetch" href="/frontend-blog/assets/js/7.f8b2bd31.js"><link rel="prefetch" href="/frontend-blog/assets/js/8.90ba358a.js"><link rel="prefetch" href="/frontend-blog/assets/js/9.62a5135c.js"><link rel="prefetch" href="/frontend-blog/assets/js/vendors~flowchart.05399e48.js">
    <link rel="stylesheet" href="/frontend-blog/assets/css/0.styles.c0ba79bd.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/frontend-blog/" class="home-link router-link-active"><!----> <span class="site-name">Nibl Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/frontend-blog/guide/comment.html" class="nav-link">评论留言</a></div><div class="nav-item"><a href="https://github.com/nibilin33" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/frontend-blog/guide/comment.html" class="nav-link">评论留言</a></div><div class="nav-item"><a href="https://github.com/nibilin33" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/frontend-blog/guide/solution.html" class="sidebar-link">记录重构心路思考</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend-blog/guide/solution.html#我的核心" class="sidebar-link">我的核心</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/solution.html#遇到的问题" class="sidebar-link">遇到的问题</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/solution.html#重构到底重构什么" class="sidebar-link">重构到底重构什么</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/solution.html#整个架构组成的思考的角度" class="sidebar-link">整个架构组成的思考的角度</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/solution.html#开发的原则" class="sidebar-link">开发的原则</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/solution.html#维护的原则" class="sidebar-link">维护的原则</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/solution.html#todo-list" class="sidebar-link">Todo List</a></li></ul></li><li><a href="/frontend-blog/guide/promto.html" class="active sidebar-link">那些年让人难受的BUG</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend-blog/guide/promto.html#内嵌web加载慢" class="sidebar-link">内嵌web加载慢</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend-blog/guide/promto.html#全流程瓶颈分析" class="sidebar-link">全流程瓶颈分析</a></li></ul></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/promto.html#android的webview概率触摸白屏" class="sidebar-link">Android的webview概率触摸白屏</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/promto.html#nginx-502问题，node-的锅？！" class="sidebar-link">NGINX 502问题，node 的锅？！</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/promto.html#大数据量情况的性能问题" class="sidebar-link">大数据量情况的性能问题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend-blog/guide/promto.html#可以用上的工具" class="sidebar-link">可以用上的工具</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/promto.html#ui性能关注点" class="sidebar-link">UI性能关注点</a></li></ul></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/promto.html#作死的兼容性问题" class="sidebar-link">作死的兼容性问题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend-blog/guide/promto.html#proxy" class="sidebar-link">Proxy</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/promto.html#date" class="sidebar-link">Date</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/promto.html#display-table-cell" class="sidebar-link">display:table-cell</a></li></ul></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/promto.html#优化会议预约" class="sidebar-link">优化会议预约</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/promto.html#优化组织架构" class="sidebar-link">优化组织架构</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/promto.html#跨部门的相爱相杀" class="sidebar-link">跨部门的相爱相杀</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend-blog/guide/promto.html#qt内嵌webview奔溃" class="sidebar-link">QT内嵌webview奔溃</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/promto.html#约定接口调用无效" class="sidebar-link">约定接口调用无效</a></li></ul></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/promto.html#离屏渲染优化" class="sidebar-link">离屏渲染优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend-blog/guide/promto.html#渲染机制" class="sidebar-link">渲染机制</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/promto.html#原理" class="sidebar-link">原理</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/promto.html#相关资料" class="sidebar-link">相关资料</a></li></ul></li></ul></li><li><a href="/frontend-blog/guide/book.html" class="sidebar-link">书籍阅读</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend-blog/guide/book.html#linux操作系统" class="sidebar-link">Linux操作系统</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend-blog/guide/book.html#基本组成" class="sidebar-link">基本组成</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/book.html#目录结构" class="sidebar-link">目录结构</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/book.html#磁盘和文件系统" class="sidebar-link">磁盘和文件系统</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/book.html#shell-脚本" class="sidebar-link">Shell 脚本</a></li></ul></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/book.html#webkit技术内幕" class="sidebar-link">Webkit技术内幕</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend-blog/guide/book.html#html-hypertext-markup-language" class="sidebar-link">HTML(hypertext markup language)</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/book.html#webkit渲染过程" class="sidebar-link">Webkit渲染过程</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/book.html#webkit-资源加载机制" class="sidebar-link">webkit 资源加载机制</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/book.html#chromium-网络栈" class="sidebar-link">Chromium 网络栈</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/book.html#web-components" class="sidebar-link">Web Components</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/book.html#javascript-的执行" class="sidebar-link">Javascript 的执行</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/book.html#css-解释器" class="sidebar-link">CSS 解释器</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/book.html#硬件加速的基础" class="sidebar-link">硬件加速的基础</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/book.html#javascript-引擎" class="sidebar-link">javascript 引擎</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/book.html#安全机制" class="sidebar-link">安全机制</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/book.html#移动webkit" class="sidebar-link">移动Webkit</a></li></ul></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/book.html#内容分发网络原理与实践-cdn" class="sidebar-link">内容分发网络原理与实践(CDN)</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/book.html#web安全深度剖析" class="sidebar-link">web安全深度剖析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend-blog/guide/book.html#理论篇" class="sidebar-link">理论篇</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/book.html#实战篇" class="sidebar-link">实战篇</a></li></ul></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/book.html#深入理解nginx" class="sidebar-link">深入理解Nginx</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/book.html#深入浅出node-js" class="sidebar-link">深入浅出node.js</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend-blog/guide/book.html#单线程" class="sidebar-link">单线程</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/book.html#node-的模块实现" class="sidebar-link">Node 的模块实现</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/book.html#核心模块" class="sidebar-link">核心模块</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/book.html#非i-o-的异步api" class="sidebar-link">非I/O 的异步API</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/book.html#nodejs基础中间件connect" class="sidebar-link">Nodejs基础中间件Connect</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/book.html#异步api添加过载保护" class="sidebar-link">异步API添加过载保护</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/book.html#v8垃圾回收机制" class="sidebar-link">V8垃圾回收机制</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/book.html#内存泄漏排查工具" class="sidebar-link">内存泄漏排查工具</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/book.html#buffer" class="sidebar-link">Buffer</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/book.html#ansi转义码" class="sidebar-link">ANSI转义码</a></li></ul></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/book.html#redis实战" class="sidebar-link">Redis实战</a></li></ul></li><li><a href="/frontend-blog/guide/code.html" class="sidebar-link">源码学习</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend-blog/guide/code.html#_5w-1h" class="sidebar-link">5W+1H</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/code.html#webpack" class="sidebar-link">webpack</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/code.html#vue" class="sidebar-link">vue</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend-blog/guide/code.html#keep-alive" class="sidebar-link">keep-alive</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/code.html#nexttick" class="sidebar-link">nextTick</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/code.html#v-on-v-bind-v-model" class="sidebar-link">v-on,v-bind,v-model</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/code.html#v-if、v-show、v-html-v-for" class="sidebar-link">v-if、v-show、v-html,v-for</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/code.html#key-的作用" class="sidebar-link">key 的作用</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/code.html#vuex" class="sidebar-link">vuex</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/code.html#vue-router" class="sidebar-link">vue-router</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/code.html#vue-server-renderer" class="sidebar-link">vue-server-renderer</a></li></ul></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/code.html#babel" class="sidebar-link">babel</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/code.html#express" class="sidebar-link">express</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/code.html#lodash" class="sidebar-link">lodash</a></li></ul></li><li><a href="/frontend-blog/guide/algorithm.html" class="sidebar-link">算法学习</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend-blog/guide/algorithm.html#算法之旅" class="sidebar-link">算法之旅</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/algorithm.html#排序" class="sidebar-link">排序</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/algorithm.html#入门到放弃：动态规划" class="sidebar-link">入门到放弃：动态规划</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/algorithm.html#滑动窗口算法" class="sidebar-link">滑动窗口算法</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/algorithm.html#二叉树" class="sidebar-link">二叉树</a></li></ul></li><li><a href="/frontend-blog/guide/webview.html" class="sidebar-link">WebView</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend-blog/guide/webview.html#pc端内嵌交互" class="sidebar-link">PC端内嵌交互</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/webview.html#pc端认证流程" class="sidebar-link">PC端认证流程</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/webview.html#移动端内嵌交互（webview）" class="sidebar-link">移动端内嵌交互（webView）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend-blog/guide/webview.html#jsbridge-的实现原理" class="sidebar-link">JSBridge 的实现原理</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/webview.html#deeplinks" class="sidebar-link">DeepLinks</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/webview.html#webviewjavascriptbridge" class="sidebar-link">WebViewJavascriptBridge</a></li></ul></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/webview.html#h5-多个webview-通信" class="sidebar-link">H5 多个webview 通信</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/webview.html#移动端认证流程" class="sidebar-link">移动端认证流程</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/webview.html#联调注意事项" class="sidebar-link">联调注意事项</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/webview.html#核心的坑" class="sidebar-link">核心的坑</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/webview.html#问题" class="sidebar-link">问题</a></li></ul></li><li><a href="/frontend-blog/guide/knowledge.html" class="sidebar-link">小知识点</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend-blog/guide/knowledge.html#运行时的一些概念" class="sidebar-link">运行时的一些概念</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/knowledge.html#浏览器工作原理" class="sidebar-link">浏览器工作原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend-blog/guide/knowledge.html#浏览器端的eventloop" class="sidebar-link">浏览器端的EventLoop</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/knowledge.html#一段代码的运行" class="sidebar-link">一段代码的运行</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/knowledge.html#javascript的核心" class="sidebar-link">JavaScript的核心</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/knowledge.html#运行时的描述" class="sidebar-link">运行时的描述</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/knowledge.html#微任务和宏任务对页面渲染的影响" class="sidebar-link">微任务和宏任务对页面渲染的影响</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/knowledge.html#you-think-you-know-javascript" class="sidebar-link">You think you know JavaScript?</a></li></ul></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/knowledge.html#xhtml-与-html-的不同" class="sidebar-link">XHTML 与 HTML 的不同</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/knowledge.html#wai-aria" class="sidebar-link">WAI-ARIA</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/knowledge.html#meta-元素" class="sidebar-link">meta 元素</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/knowledge.html#a-元素的功能" class="sidebar-link">A 元素的功能</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/knowledge.html#img-新增实用属性" class="sidebar-link">IMG 新增实用属性</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/knowledge.html#h5新增日期类型（chrome）" class="sidebar-link">H5新增日期类型（chrome）</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/knowledge.html#iframe" class="sidebar-link">Iframe</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/knowledge.html#多媒体元素" class="sidebar-link">多媒体元素</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/knowledge.html#bef-和-margin-collapse" class="sidebar-link">BEF 和 Margin Collapse</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/knowledge.html#关于定位" class="sidebar-link">关于定位</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/knowledge.html#恶补css知识点" class="sidebar-link">恶补CSS知识点</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/knowledge.html#网络" class="sidebar-link">网络</a></li></ul></li><li><a href="/frontend-blog/guide/requirements.html" class="sidebar-link">代码实践</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend-blog/guide/requirements.html#编码风格" class="sidebar-link">编码风格</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/requirements.html#开发前可考虑的事情" class="sidebar-link">开发前可考虑的事情</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/requirements.html#oop的设计步骤" class="sidebar-link">OOP的设计步骤</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/requirements.html#测试驱动开发的具体实践" class="sidebar-link">测试驱动开发的具体实践</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/requirements.html#typescript-运用" class="sidebar-link">Typescript 运用</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/requirements.html#定制化构想" class="sidebar-link">定制化构想</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/requirements.html#领域驱动设计" class="sidebar-link">领域驱动设计</a></li></ul></li><li><a href="/frontend-blog/guide/tool.html" class="sidebar-link">工具说明</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend-blog/guide/tool.html#环境准备" class="sidebar-link">环境准备</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/tool.html#国际化" class="sidebar-link">国际化</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/tool.html#项目发布" class="sidebar-link">项目发布</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/tool.html#代码生成" class="sidebar-link">代码生成</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/tool.html#代码分析" class="sidebar-link">代码分析</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/tool.html#自动化测试" class="sidebar-link">自动化测试</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/tool.html#自动下载并安装软件" class="sidebar-link">自动下载并安装软件</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/tool.html#linux-初始化node-环境shell-脚本" class="sidebar-link">Linux 初始化node 环境shell 脚本</a></li></ul></li><li><a href="/frontend-blog/guide/electron.html" class="sidebar-link">Electron</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend-blog/guide/electron.html#起步" class="sidebar-link">起步</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/electron.html#参考" class="sidebar-link">参考</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/electron.html#使用" class="sidebar-link">使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend-blog/guide/electron.html#加入项目作为内嵌模拟工具" class="sidebar-link">加入项目作为内嵌模拟工具</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/electron.html#模拟终端完成拦截返回本地资源逻辑" class="sidebar-link">模拟终端完成拦截返回本地资源逻辑</a></li></ul></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/electron.html#可能遇到的问题" class="sidebar-link">可能遇到的问题</a></li></ul></li><li><a href="/frontend-blog/guide/min-routine.html" class="sidebar-link">小程序</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend-blog/guide/min-routine.html#起步" class="sidebar-link">起步</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/min-routine.html#遇到的问题" class="sidebar-link">遇到的问题</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/min-routine.html#canvas-性能差异" class="sidebar-link">canvas 性能差异</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/min-routine.html#模拟器实现分析" class="sidebar-link">模拟器实现分析</a></li></ul></li><li><a href="/frontend-blog/guide/serverless.html" class="sidebar-link">Serverless</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend-blog/guide/serverless.html#什么是serverless" class="sidebar-link">什么是serverless</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/serverless.html#fission-linux-环境搭建" class="sidebar-link">Fission Linux 环境搭建</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/serverless.html#遇到的问题" class="sidebar-link">遇到的问题</a></li></ul></li><li><a href="/frontend-blog/guide/penetration.html" class="sidebar-link">渗透测试</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend-blog/guide/penetration.html#安装kail-linux" class="sidebar-link">安装Kail Linux</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/penetration.html#android-手机安装kail-linux" class="sidebar-link">Android 手机安装Kail Linux</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/penetration.html#尝试攻击自己的服务器🔞" class="sidebar-link">尝试攻击自己的服务器🔞</a></li></ul></li><li><a href="/frontend-blog/guide/component.html" class="sidebar-link">组件说明</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend-blog/guide/component.html#组织架构" class="sidebar-link">组织架构</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/component.html#会议" class="sidebar-link">会议</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/component.html#日程表" class="sidebar-link">日程表</a></li></ul></li><li><a href="/frontend-blog/guide/cooperation.html" class="sidebar-link">协作的实现</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend-blog/guide/cooperation.html#阅读源码（etherpad）" class="sidebar-link">阅读源码（etherpad）</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/cooperation.html#参考文档" class="sidebar-link">参考文档</a></li></ul></li><li><a href="/frontend-blog/guide/design.html" class="sidebar-link">设计模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend-blog/guide/design.html#惰性单例模式" class="sidebar-link">惰性单例模式</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/design.html#发布订阅vs观察者" class="sidebar-link">发布订阅vs观察者</a></li></ul></li><li><a href="/frontend-blog/guide/interview.html" class="sidebar-link">面试</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend-blog/guide/interview.html#项目经历描述" class="sidebar-link">项目经历描述</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/interview.html#面试题" class="sidebar-link">面试题</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/interview.html#面试准备" class="sidebar-link">面试准备</a></li></ul></li><li><a href="/frontend-blog/guide/me.html" class="sidebar-link">README</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend-blog/guide/me.html#我" class="sidebar-link">我</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/me.html#离开" class="sidebar-link">离开</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/me.html#职业的规划" class="sidebar-link">职业的规划</a></li><li class="sidebar-sub-header"><a href="/frontend-blog/guide/me.html#对团队的期望" class="sidebar-link">对团队的期望</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="内嵌web加载慢"><a href="#内嵌web加载慢" aria-hidden="true" class="header-anchor">#</a> 内嵌web加载慢</h2> <p>优化的核心是让服务端的资源能够本地化<br> <strong>方案一：PWA</strong><br>
那么什么是PWA？</p> <blockquote><p>Progressive Web App, 简称 PWA，是提升 Web App 的体验的一种新方法，能给用户原生应用的体验。
PWA 能做到原生应用的体验不是靠特指某一项技术，而是经过应用一些新技术进行改进，
在安全、性能和体验三个方面都有很大提升，PWA 本质上是 Web App，
借助一些新技术也具备了 Native App 的一些特性，兼具 Web App 和 Native App 的优点。</p></blockquote> <blockquote><p>PWA 的主要特点包括下面三点：</p> <ul><li>可靠 - 即使在不稳定的网络环境下，也能瞬间加载并展现</li> <li>体验 - 快速响应，并且有平滑的动画响应用户的操作</li> <li>粘性 - 像设备上的原生应用，具有沉浸式的用户体验，用户可以添加到桌面<br>
PWA 本身强调渐进式，并不要求一次性达到安全、性能和体验上的所有要求，开发者可以通过 PWA Checklist 查看现有的特征。</li></ul></blockquote> <p>具体的可以查看 <a href="https://lavas.baidu.com/pwa/README" target="_blank" rel="noopener noreferrer">https://lavas.baidu.com/pwa/README<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br>
或者 <a href="https://lavas-project.github.io/pwa-book/" target="_blank" rel="noopener noreferrer">PWA 应用实战<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br> <strong>想法</strong><br>
PWA请求一次后资源都缓存在本地了，可以利用这个特点，在终端启动的时候先请求<br>
往后所有资源都可以在缓存里面拿，当资源需要更新的时候，Service Worker 也提供<br>
更新资源的方法。<br>
这样从缓存到更新所有策略都无需终端干涉，终端目测只要修改cef的一些配置。<br>
但目前来看，server-workder 有https,或者127.0.0.1 的限制。<br>
如果为http请求无法注册成功。</p> <p><strong>方案二：</strong><br>
终端代理所有请求，服务器下发一个资源列表，终端根据资源列表提前下载资源到本地。<br>
当发现请求命中资源列表，则返回本地的资源，不然直接放行请求去拉取服务器资源。<br>
服务器会提供获取资源列表的文件请求。<br>
当发现变更的时候，需要更新这个资源列表文件，并进行下载。<br>
生成资源列表的webpack-plugin可以到我的vue-solutions 查看</p> <p><strong>方案三：</strong><br>
资源包有NG做目录映射</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>location /web_zip/xx {  
root /usr/local/xxx; 
autoindex on;   
expires 12h;    
proxy_store on；    
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>验证资源包完整性：
linux : md5sum<br>
windows: certutil -hashfile 文件名  MD5<br>
前提：本地已经下载好资源。node需要支持跨域请求</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>    app.use(&quot;*&quot;, function(req, res, next) {
        res.header(&quot;Access-Control-Allow-Origin&quot;, &quot;*&quot;);
        res.header(
          &quot;Access-Control-Allow-Headers&quot;,
          &quot;Content-Type, Content-Length, Authorization, Accept, X-Requested-With , Origin&quot;
        );
        res.header(&quot;Access-Control-Allow-Methods&quot;, &quot;PUT, POST, GET, DELETE, OPTIONS&quot;);
        next();
    });
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>用file协议直接打开index.html，前端路由模式需要改成hash。<br>
在ajax请求方面，如果webview能够拦截请求，需要判断是请求资源还是接口请求。<br>
在图片资源全部变成base64, base64-inline-loader<br>
{
test: /.(jpe?g|png|ttf|eot|svg|woff(2)?)(?[a-z0-9=&amp;.]+)?$/,
use: 'base64-inline-loader?limit=1000&amp;name=[name].[ext]'
}
如果是接口请求，需要加上服务器地址。<br>
如果无法拦截，就需要向终端获取服务器地址。<br>
初始版本号和资源包会打包到应用里面，版本变更的时候，通过通道通知客户端，
客户端比对服务器下方的版本好与本地版本号是否一致，
下载资源包替换。<br>
如果下载解压过程异常，文件被篡改，则改回请求远程服务器。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>  打包方式的修改  
 &quot;buildLocal&quot;: &quot;cross-env ROOTPATH=./ node build/build.js -n pc &amp;&amp; node build/themeExtract.js -p ./&quot;  
 把全局变量注入  
new webpack.DefinePlugin({
    'process.env': env,
    'ROOTPATH': !!process.env.ROOTPATH
})

webpack.base.conf.js  
    const imgLoader = !!process.env.ROOTPATH ?  
    {
        test: /\.(jpe?g|png|ttf|eot|svg|woff(2)?)(\?[a-z0-9=&amp;.]+)?$/,
        use: 'base64-inline-loader?limit=10000&amp;name=[name].[ext]'
    }: {
        test: /\.(png|jpe?g|gif|svg)(\?.*)?$/,
        loader: 'url-loader',
        options: {
            limit: 10,
            name: utils.assetsPath('img/[name].[hash:7].[ext]')
        }
    };
    const fontLoader = !!process.env.ROOTPATH ?
    {} :{
        test: /\.(woff2?|eot|ttf|otf|swf)(\?.*)?$/,
        loader: 'url-loader',
        options: {
            limit: 10000,
            name: utils.assetsPath('fonts/[name].[hash:7].[ext]')
        }
    };  
------------------------------------
     const PATH = process.env.ROOTPATH ? process.env.ROOTPATH : '/ume/';
     assetsPublicPath: PATH
     
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h3 id="全流程瓶颈分析"><a href="#全流程瓶颈分析" aria-hidden="true" class="header-anchor">#</a> 全流程瓶颈分析</h3> <p><strong>1.常用命令</strong><br>
查看系统：cat /proc/version<br>
查看系统版本： cat /etc/os-release<br>
查看进程： ps<br> <strong>2.数据分析搜集并且图形化</strong><br> <a href="http://nmon.sourceforge.net/pmwiki.php" target="_blank" rel="noopener noreferrer">nmon<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br>
1）tar -zxvf nmon16e_mpginc.tar.gz<br>
2）拷贝并重命名 cp nmon_x86_64_centos /usr/bin/nmon<br>
3）授权 chmod 777 nmon
4）root 可执行 ln -s /usr/bin/nmon /usr/sbin/nmon
5) nmon -f -t -s 30 -c 10 -m /home/
6) 通过sort命令可以将nmon结果文件转换为csv文件 sort -A LS-HDP-MH-VM-173-188_161108_1412.nmon&gt; LS-HDP-MH-VM-173-188_161108_1412.csv
7) nmon_analyser（生成性能报告）
</p><details><summary>nmon 参数意思</summary> <a href="https://blog.csdn.net/qq_39720249/article/details/84325837" target="_blank" rel="noopener noreferrer">报表参数详解<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br>
-f     电子表格输出格式[注意：默认-s300 -c288]   输出文件是{hostname} _YYYYMMDD_HHMM.nmon<br>
-F    {filename},与-f相同，但用户提供的文件名<br>
-c   {number}快照数<br>
-d    请求磁盘服务和等待时间（DISKSERV和DISKWAIT）<br>
-i    {percent}在使用少于此数量的CPU时忽略进程生成TOP部分 - 对减少数据量很有用<br>
-g   {filename}包含磁盘组定义的文件<br>
-l    {dpl}每张纸的hdisk数 - 默认为150，最大为250.<br>
-m   {dir} NMON在保存文件之前更改为此目录<br>
-r    {runname}进入电子表格文件[默认主机名]<br>
-s    {秒}快照之间的间隔<br>
-x    容量规划（1天时间，每15分钟监控一次= -fdt -s900 -c96）<br>
-t    包括输出中的顶级进程<br>
-T    as -t plus在UARG部分保存命令行参数<br>
-A    包括异步I / O（PROCAIO）部分的数据<br>
-D    防止生成DISK部分（在磁盘组时有用）正在使用，因为有太多的硬盘要处理）<br>
-E    停止生成ESS部分（磁盘组时需要）正在使用因为有太多的vpath要处理）<br>
-J    防止生成JFS部分（防止Excel错误当你有超过255个文件系统）<br>
-L    包括LARGEPAGE部分<br>
-N    包括NFS部分<br>
-S    包括带子类的WLM部分<br>
-W    包括没有子类的WLM部分<br>
-Y    包括SUMMARY部分（非常有效的替代-t if不需要PID级别数据）<br></details><p></p> <p><strong>3.结论</strong></p> <h2 id="android的webview概率触摸白屏"><a href="#android的webview概率触摸白屏" aria-hidden="true" class="header-anchor">#</a> Android的webview概率触摸白屏</h2> <p>网上看到的一个类似的解释：<br>
webkit在绘制页面时会将结构分为各种层，<br>
当层足够大时就会变成很大的平铺层。<br>
这样一来webkit在每次页面结构发生变化时不需要都渲染整个页面而是渲染对应层了，<br>
这对渲染速度来说相当的重要。<br>
webkit会给各种层分配一定大小的“后备存储器”在内存里缓存起来，<br>
这就是绘制层的上下文，通过这个上下文就可以很容易的实现各种效果（动画，3D变换等），<br>
“后备存储器”内存占用大小不仅依层而定，<br>
跟设备和显示方式也是有关的，假设这在普通屏幕下是1：1的，<br>
但在Retina屏幕下则是1：2的，并且放大时这个量会成倍增加；<br>
一张图片是10X10，普通屏幕分配的就是10X10，Retina初始则是20X20。<br>
这也表明Retina是更加消耗内存的。<br>
当层很大时，意味着“后备存储器”会消耗更大的内存，为了避免这点，<br>
webkit并不会绘制一个很大的层来存储一个很大的页面，<br>
比如说平铺层则会拆分成很多的块来绘制，即尽占用尽可能小的内存，<br>
只是将可视范围内的那部分渲染出来。<br>
这就是为什么我们在大页面滚动时会发现下面的内容慢慢显示，<br>
向上滚动时上面的内容还慢慢显示的原因。</p> <p>以下则是webkit划分为层绘制的场景：</p> <p>1、页面主容器永远是独立的平铺层<br>
2.绘制密集型元素时，如video，canvas<br>
3、应用3D transformations的元素，包括translate3d, rotate3d, translateZ<br>
4、内容被加强时，如Filters, masks, reflections, opacity, transitions, animations<br>
5、某些特殊的情况下也会，如position:fixed, -webkit-overflow-scrolling:touch<br>
6、任何在已知层上覆盖的内容</p> <p><strong>所以解决方案就是Android开启硬件加速</strong></p> <h2 id="nginx-502问题，node-的锅？！"><a href="#nginx-502问题，node-的锅？！" aria-hidden="true" class="header-anchor">#</a> NGINX 502问题，node 的锅？！</h2> <p>对于一个没有服务器任何相关经验的人类，<br>
接收到这样的一个结论，感受到巨大的恶意。<br>
叕一次踏上自证清白的道路。<br>
过程：<br>
我分析NG日志，发现NG在尝试连接node服务，被拒绝了。<br>
便决定压测。<br>
1.简单的node服务</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>const express = require('express');
const path = require('path');
const app = express();
const http =  require(&quot;http&quot;);
const log4js = require('log4js');
log4js.configure({
    appenders: { cheese: { type: 'file', filename: 'cheese.log' } },
    categories: { default: { appenders: ['cheese'], level: 'error' } }
});
const logger = log4js.getLogger('cheese');
app.use(log4js.connectLogger(logger));
app.use(express.static(path.join(__dirname,'docs')));
app.use(function(request, response) {
    try {
        response.sendFile(path.resolve('docs/index.html'));
    }catch (e) {
        logger.error('sendFile error %s', e.toString());
    }
});
http.createServer(app).listen(3000, '0.0.0.0', function () {
    var host = this.address().address;
    var port = this.address().port;
    logger.error('Service listening http at http://%s:%s', host, port);
});
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>2.Locust—python压力测试工具<br> <a href="https://docs.locust.io/en/stable/what-is-locust.html" target="_blank" rel="noopener noreferrer">使用文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br>
简单的locustio脚本</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># coding: utf-8
from locust import HttpLocust, TaskSet, task  
class MyTaskSet(TaskSet):
    @task(1)
    def index(self):
        self.client.get(&quot;/ume/extension&quot;)

class MyLocust(HttpLocust):
    task_set = MyTaskSet
    min_wait = 5000
    max_wait = 15000
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">windows版</p> <p>安装：pip install locustio<br>
如果安装失败，把版本降低地装 pip install locustio==0.13.1<br>
跑起来<br>
locust -f locustTest.py --host=http://<br>
访问 localhost:8089 开始模拟并发<br> <img src="https://github.com/nibilin33/frontend-blog/raw/master/press/guide/img/locust.png" alt="本地执行文件"><br> <img src="https://github.com/nibilin33/frontend-blog/raw/master/press/guide/img/web.png" alt="图形界面"></p></div> <div class="custom-block tip"><p class="custom-block-title">Linux版</p> <p>python2.7安装：pip install locustio<br>
安装失败，版本不支持，换：pip install locustio==0.13.5<br>
安装request失败，版本问题，换：pip install -I requests==2.14.2<br>
locust -f locustTest.py --no-web -c 2000 -r 500 -t 3000</p></div> <p><strong>结论</strong><br>
请求html，直接压node没有问题，2000用户并发400，可以处理过来，但是加上NG代理，出现失败。<br>
最后排查到后端代码出现端口占用的问题。<br>
因为单个HTML文件输出的大小不是很大，决定加上资源文件做并发压测。<br>
结果发现，资源文件在并发400的时候有1%的情况输出失败。<br>
分析了一下机子的情况，发现IO利用率不高，都是在磁盘写。<br>
于是发现express没有配缓存，调参小能手，解决。</p> <h2 id="大数据量情况的性能问题"><a href="#大数据量情况的性能问题" aria-hidden="true" class="header-anchor">#</a> 大数据量情况的性能问题</h2> <h3 id="可以用上的工具"><a href="#可以用上的工具" aria-hidden="true" class="header-anchor">#</a> 可以用上的工具</h3> <ul><li>css 压力测试(css stress test)</li> <li>css 性能分析器（the css profilers are coming）</li> <li>css lint</li> <li>dom monster</li></ul> <h3 id="ui性能关注点"><a href="#ui性能关注点" aria-hidden="true" class="header-anchor">#</a> UI性能关注点</h3> <ul><li>大量元素应用border-radius会拖慢页面</li> <li>调整移动设备的viewport标签可以减少渲染时间</li> <li>旧版webkit boxshandows 在滚动和渲染会有延迟问题</li> <li>css 径向渐变在某些浏览器会有渲染问题，特别是Android</li> <li>避免使用IE css 滤镜，会有性能问题</li> <li>使用硬件加速css动画替代javascript动画</li></ul> <h2 id="作死的兼容性问题"><a href="#作死的兼容性问题" aria-hidden="true" class="header-anchor">#</a> 作死的兼容性问题</h2> <h3 id="proxy"><a href="#proxy" aria-hidden="true" class="header-anchor">#</a> Proxy</h3> <p>开发的时候确定了不考虑IE，结果遇到功能复用，用iframe做隔离，确定会遇上爱情....(～￣(OO)￣)ブ<br>
这是一个开发了两周，每天1000行的功能,试过polyfill依旧有问题，怎么办....<br>
突然想到，vue3用proxy替代之前的Object.defineProperty....(～￣(OO)￣)ブ<br></p><details><summary>Show Me The Code</summary><p></p> <p>import {
isFunction,
} from 'lodash';
import {
firstLetterUpperCase,
} from '@/utils/tools';</p> <p>class CustomProxy {
params = {}</p> <pre><code>constructor(data) {
    Object.keys(data).forEach((name) =&gt; {
        Object.defineProperty(this.params, name, {
            enumerable: true,
            configurable: true,
            get: () =&gt; data[name],
            set: (newValue) =&gt; {
                isFunction(data[`set${firstLetterUpperCase(name)}`])
                &amp;&amp; data[`set${firstLetterUpperCase(name)}`](newValue);
                data[name] = newValue;
            },
        });
    });
}
</code></pre> <p>}
export default function createDefensiveObject(data) {
return new CustomProxy(data);
}</p></details> <h3 id="date"><a href="#date" aria-hidden="true" class="header-anchor">#</a> Date</h3> <p>new Date('2019-01-01 10:00') 这种方式在除了ie都行<br>
ie 要用new Date('2019-01-01T10:00')<br>
new Date('2019/01/01T10:00') 在Firefox上有问题</p> <h3 id="display-table-cell"><a href="#display-table-cell" aria-hidden="true" class="header-anchor">#</a> display:table-cell</h3> <p>设定height为具体某个值，在Firefox上显示是设定值*2<br>
解决：tr上overflow:hidden，并且设定高度</p> <h2 id="优化会议预约"><a href="#优化会议预约" aria-hidden="true" class="header-anchor">#</a> 优化会议预约</h2> <div class="custom-block tip"><p>背景： 公司的真实会议室+虚拟会议市&gt;100，页面要展示两天的会议记录，以15分钟为一个间隔。再加上
每天一个会议室至少有5个会议。页面渲染卡顿，然后蹦了。</p></div> <p>因为一进去就蹦了，我根本没法用devtools分析哪个环境出问题，只能看代码。<br>
做了我认为最小原则的调整。</p> <ol><li>只展示可视区间的节点</li> <li>减少不必要的vue的双向绑定数据，减少事件绑定。<br>
原本的设计是每一个时间格都是一个组件，每个格子都有拖拽的事件监听，每个格子都有自己的tooltip，<br>
每个格子都知道会议的大量信息，你想想，48x4x100，1W多的节点，1W多的数据量，得有多少重复无用的数据。<br>
我就做大量的精简工作，每个时间格子就单纯点，不需要知道那么多信息，只需要知道坐标就好。<br>
全局就一个tooltip，鼠标移动过去的时候，tooltip跟过去就好。所有需要展示的内容回调最外层的组件就好。</li></ol> <p>一波操作调整后，几百个会议室都是秒出来，操作也不卡顿，也不再奔溃了。</p> <div class="custom-block tip"><p>优化，基本都是在做剪枝操作，就是尽量提取必修的，减少冗余。</p></div> <h2 id="优化组织架构"><a href="#优化组织架构" aria-hidden="true" class="header-anchor">#</a> 优化组织架构</h2> <h4 id="难受的历史"><a href="#难受的历史" aria-hidden="true" class="header-anchor">#</a> 难受的历史</h4> <blockquote><p>1.大数据量情况页面切换两下浏览器崩溃了<br>
2.默认勾选容易费时太长奔溃<br>
3.渲染压力太大<br>
4.内存只增不减<br>
5.慢</p></blockquote> <h4 id="第一版：内存泄漏"><a href="#第一版：内存泄漏" aria-hidden="true" class="header-anchor">#</a> 第一版：内存泄漏</h4> <p>问题代码
<img src="https://github.com/nibilin33/frontend-blog/raw/master/press/guide/img/wrongcode.png" alt="问题代码">
循环引用导致无法GC<br>
解决代码</p> <h4 id="第一段解决代码的灵感来自-《垃圾回收算法手册》这本书"><a href="#第一段解决代码的灵感来自-《垃圾回收算法手册》这本书" aria-hidden="true" class="header-anchor">#</a> 第一段解决代码的灵感来自 《垃圾回收算法手册》这本书</h4> <p><img src="https://github.com/nibilin33/frontend-blog/raw/master/press/guide/img/book.png" alt="垃圾回收算法手册"></p> <h4 id="第二版：性能提升-最小化原则"><a href="#第二版：性能提升-最小化原则" aria-hidden="true" class="header-anchor">#</a> 第二版：性能提升 --- 最小化原则</h4> <ul><li>[x] 废弃JQ --(180KB+30KB)你如果非常需要dom操作的工具时候，就要想到，庞大的东西必然有人会去简化，我们可以参考zepto去实现一版更小的工具类$</li> <li>[x] 大数据量展示 -- clusterize.js(7KB)(只展示可视区间的节点)
####人生要有一种信念，没有你<s>做不到</s>找不到，只有你想不到
你能想到的优化点，基本都有人实现过了，不用从头造轮子，把期望目标转成关键词搜索 https://github.com/cheton/infinite-tree</li></ul> <h4 id="edge-记录ui响应"><a href="#edge-记录ui响应" aria-hidden="true" class="header-anchor">#</a> Edge(记录UI响应)</h4> <p>修改前,初始化需要4,241.812 ms<br>
修改后，1,421.073 ms</p> <h4 id="chrome"><a href="#chrome" aria-hidden="true" class="header-anchor">#</a> Chrome</h4> <p>修改前 784.133ms<br>
修改后 90.811ms
旧版树 471.270ms</p> <details><summary>Show Me The Code</summary>
只有一个目的，去掉双向绑定，由这个对象做所有树对象的内存管理，手动去垃圾回收    
当然去掉双向绑定还有一个方法，Object.freeze(),这代表这个数据你不能做任何操作，只能查看。    
<div class="language- line-numbers-mode"><pre class="language-text"><code>class nbTree {  
constructor() { 
    this.nbTree = {};   
}   
}   
export default new nbTree();    
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></details> <h4 id="利用好console"><a href="#利用好console" aria-hidden="true" class="header-anchor">#</a> 利用好console</h4> <ul><li>[x] 占用内存 ---- console.memory</li> <li>[x] 花费时间 ---- console.profile(),console.profileEnd()</li></ul> <h2 id="跨部门的相爱相杀"><a href="#跨部门的相爱相杀" aria-hidden="true" class="header-anchor">#</a> 跨部门的相爱相杀</h2> <h3 id="qt内嵌webview奔溃"><a href="#qt内嵌webview奔溃" aria-hidden="true" class="header-anchor">#</a> QT内嵌webview奔溃</h3> <div class="custom-block tip"><p>背景：上传一个2M多的图片，webview的render进程就奔溃了。</p></div> <p>客户端认为是一次没法开辟那么大的内存空间，要求前端做图片大小的限制，<br>
但前端本身已经限制了10M大小，而且直接在chrome浏览器上做上传，浏览器并没有奔溃。<br>
想想也知道，才2M多就奔溃是什么鬼。我不能接受这种解决方案，因为QT的内嵌内核和chrome是一样的，<br>
都是拿chromium弄的，既然chrome不会奔溃，那一定是有什么参数配置可以调。万能的Google，<br>
我习惯是用英文关键词做搜索，只要关键词对了，基本都能找到国外的丰富的答案。<br>
然后发现，chromium编译的时候是默认没有大地址模式，需要重新编译加上大地址模式...</p> <h3 id="约定接口调用无效"><a href="#约定接口调用无效" aria-hidden="true" class="header-anchor">#</a> 约定接口调用无效</h3> <div class="custom-block tip"><p>背景： 前端把方法挂在window上，终端调用window上的方法，然而终端没有拿到回执。</p></div> <p>🐵：没收到数据<br>
🐧：没看到你调用<br>
🐵：不可能，你写的不对吧<br>
🐧：把你调用的地方截图我看看<br>
🐵：你看不懂的，这个是swift<br>
🐧：show me your code<br>
🐧：你的语法...错了吧<br>
🐵：怎么可能...<br>
🐵：...<br>
🐵：再见</p> <div class="custom-block tip"><p>代码是不会说谎的，各执己见，不如show code。</p></div> <h2 id="离屏渲染优化"><a href="#离屏渲染优化" aria-hidden="true" class="header-anchor">#</a> 离屏渲染优化</h2> <p>看electron看到离屏渲染，就找资料了解了一下。</p> <h3 id="渲染机制"><a href="#渲染机制" aria-hidden="true" class="header-anchor">#</a> 渲染机制</h3> <p>CPU将计算好的需要显示的内容提交给GPU，GPU渲染完成后将渲染结果放入帧缓冲区，随后视频控制器会按照Vsync(垂直脉冲)信号逐行读取帧缓冲区的数据，经过可能的数模转换传递给显示器进行显示。</p> <h3 id="原理"><a href="#原理" aria-hidden="true" class="header-anchor">#</a> 原理</h3> <p>GPU在当前屏幕缓冲区以外新开辟一个缓冲区进行渲染操作。</p> <h3 id="相关资料"><a href="#相关资料" aria-hidden="true" class="header-anchor">#</a> 相关资料</h3> <p>https://juejin.im/post/5dc3ad196fb9a04ac07ce1a0#heading-0<br>
http://www.cocoachina.com/articles/26292</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/frontend-blog/guide/solution.html" class="prev">记录重构心路思考</a></span> <span class="next"><a href="/frontend-blog/guide/book.html">书籍阅读</a>→
    </span></p></div> </main></div><div class="global-ui"><div></div></div></div>
    <script src="/frontend-blog/assets/js/app.796b580c.js" defer></script><script src="/frontend-blog/assets/js/3.b1978073.js" defer></script><script src="/frontend-blog/assets/js/31.c2069332.js" defer></script>
  </body>
</html>
